<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>internationalisation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Internationalisation</span> <span class="project-version">1.0.3-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>internationalisation</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 "><a href="scot.weft.i18n.core.html"><div class="inner"><span>scot.weft.i18n.core</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#internationalisation" name="internationalisation"></a>internationalisation</h1>
<p>A Clojure library designed to provide simple interationalisation of user-facing messages.</p>
<h2><a href="#usage" name="usage"></a>Usage</h2>
<p>To use this library in your project, add the following leiningen dependency:</p>
<pre><code>[org.clojars.simon_brooke/internationalisation "1.0.4"]
</code></pre>
<p>To use it in your namespace, require:</p>
<pre><code>[scot.weft.i18n.core :refer [get-message get-messages]]
</code></pre>
<p>There is only two functions you may need to use:</p>
<h3><a href="#get-messages" name="get-messages"></a>get-messages</h3>
<pre><code class="clojure">(get-messages accept-language-header resource-path default-locale)
</code></pre>
<p>Return the most acceptable messages collection we have given this <code>accept-language-header</code>.</p>
<ul>
  <li><code>accept-language-header</code> should be a string representing the value of an RFC 2616 Accept-Language header;</li>
  <li><code>resource-path</code> should be a string representing the fully-qualified path name of the directory in which message files are stored;</li>
  <li><code>default-locale</code> should be a string representing a locale specifier to use if no acceptable locale can be identified.</li>
</ul>
<p>For example:</p>
<pre><code class="clojure">(get-messages "en-GB;q=0.9, fr-FR" "i18n" "en-GB")
</code></pre>
<p>Returns a map of message keys to strings.</p>
<p>See <a href="https://www.ietf.org/rfc/rfc2616.txt">RFC 2616</a>.</p>
<p><strong>NOTE THAT</strong> <code>get-messages</code> is <a href="https://clojuredocs.org/clojure.core/memoize">memoized</a> resulting in faster response when called repeatedly with similar arguments.</p>
<h3><a href="#get-message" name="get-message"></a>get-message</h3>
<p>A wrapper around <code>get-messages</code> to resolve a single, particular message. </p>
<pre><code class="clojure">(get-message token)

(get-message token accept-language-header)

(get-message token accept-language-header resource-path default-locale)
</code></pre>
<p>where</p>
<ul>
  <li><code>token</code> is the Clojure <a href="https://clojuredocs.org/clojure.core/keyword">keyword</a> which identifies the particular message you want to retrieve;</li>
</ul>
<p>and all the other arguments are as defined above.</p>
<p>For example:</p>
<pre><code class="clojure">(get-message :pipe)

(get-message :pipe "en-GB;q=0.9, fr-FR")

(get-message :pipe "de-DE" "i18n" "ru")
</code></pre>
<p>So how does this work? When one calls <code>(get-message token accept-language-header)</code>, how does it know where to find resources? The answer is that there are two dynamic variables:</p>
<ul>
  <li><code>*resource-path*</code>, the default path within the resources space on which  translation files will be sought. Initialised to <code>i18n</code>.</li>
  <li><code>*default-language*</code>, the language tag for the language to use when no  otherwise suitable language can be identified. Initialised to the default  language of the runtime session, so this may well be different on your  machine from someone elses running identical software.</li>
</ul>
<p>Thus</p>
<pre><code class="clojure">(binding [*resource-path* "language-files"
          *default-language* "en-CA"]
    (get-message :pipe "en-GB;q=0.9, fr-FR")
)
</code></pre>
<p>and</p>
<pre><code class="clojure">(get-message :pipe "en-GB;q=0.9, fr-FR" "language-files" "en-CA")
</code></pre>
<p>are effectively the same.</p>
<p>The intelligent reader will note that if one calls</p>
<pre><code class="clojure">(get-message :pipe)
</code></pre>
<p>there’s no mechanism to set the <code>accept-header</code>. This is true. The expected use case for this arity of the function is in desktop applications where the locale of the local machine will always be the correct locale to use. The two-argument arity of the function is intended for web applications, where different clients may have different linguistic needs.</p>
<p><strong>NOTE THAT</strong> <code>get-message</code> is also memoized, and for the same reason.</p>
<h2><a href="#the-translation-files" name="the-translation-files"></a>The translation files</h2>
<p>Obviously, this only works if you provide files with translations of your interesting strings. These files should contain Clojure maps, and the file names should be the locale string for which the file is relevent followed by the extension “.edn”. All the translation files should be in the same directory.</p>
<p>In this project you will find two very simple example files, which should give you the idea:</p>
<h3><a href="#en-gb-edn" name="en-gb-edn"></a>en-GB.edn</h3>
<pre><code>;;;; This is a British English translation file.

{:pipe "This is not a pipe"}
</code></pre>
<h3><a href="#fr-fr-edn" name="fr-fr-edn"></a>fr-FR.edn</h3>
<pre><code>;;;; This is a French translation file.

{:pipe "Ceci n'est pas une pipe."}
</code></pre>
<h2><a href="#documentation" name="documentation"></a>Documentation</h2>
<p>Documentation may be generated by running</p>
<pre><code>lein codox
</code></pre>
<h2><a href="#license" name="license"></a>License</h2>
<p>Copyright © 2017 Simon Brooke</p>
<p>Distributed under the Eclipse Public License either version 1.0 or (at your option) any later version.</p></div></div></div></body></html>